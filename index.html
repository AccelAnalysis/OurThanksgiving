<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Thanksgiving Potluck Signup</title>

  <!-- Cozy Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      /* Thanksgiving palette */
      --cranberry:#9c2f2f;
      --pumpkin:#f56004;
      --gold:#dbba33;
      --warm-brown:#633f21;
      --deep-brown:#2a1710;
      --cream:#fff7ea;

      --card:#ffffff;
      --text:#22130d;
      --muted:#6a564f;

      --radius:18px;
      --shadow:0 12px 30px rgba(34,19,13,.18);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 600px at 10% -10%, #ffe8c6 0%, transparent 60%),
        radial-gradient(900px 600px at 110% -20%, #ffe0e0 0%, transparent 62%),
        linear-gradient(#fff4de, #fff1e3);
    }

    /* Hero */
    .hero{
      position:relative;
      min-height:42vh;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:28px 16px;
      background:
        linear-gradient( to bottom, rgba(0,0,0,.35), rgba(0,0,0,.35) ),
        url("https://source.unsplash.com/featured/?thanksgiving,table,fall") center/cover no-repeat;
      color:white;
    }
    .hero-inner{
      max-width:900px;
      backdrop-filter: blur(2px);
      background:rgba(0,0,0,.25);
      border:1px solid rgba(255,255,255,.25);
      border-radius:22px;
      padding:18px 16px;
    }
    .hero h1{
      font-family: "Playfair Display", serif;
      font-weight:800;
      font-size:clamp(1.8rem,4.8vw,3rem);
      margin:0 0 6px;
      letter-spacing:.3px;
    }
    .hero p{
      margin:0;
      font-size:clamp(1rem,2.4vw,1.2rem);
      opacity:.95;
    }

    .wrap{
      max-width:1100px;
      margin:-36px auto 44px;
      padding:0 14px;
      display:grid;
      gap:14px;
      grid-template-columns:1.1fr .9fr;
    }
    @media (max-width: 900px){ .wrap{grid-template-columns:1fr;} }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
      border:1px solid rgba(34,19,13,.06);
    }
    .card h2{
      font-family:"Playfair Display", serif;
      margin:0 0 10px;
      font-size:1.4rem;
      color:var(--deep-brown);
    }

    /* List */
    .category{
      background:var(--cream);
      border:1px dashed rgba(99,63,33,.25);
      border-radius:14px;
      padding:10px;
      margin:10px 0;
    }
    .category h3{
      margin:0 0 8px;
      font-size:1.05rem;
      display:flex;
      align-items:center;
      gap:8px;
      color:var(--warm-brown);
    }
    .pill{
      font-size:.78rem;
      padding:2px 8px;
      border-radius:999px;
      background:#fff;
      border:1px solid rgba(99,63,33,.2);
      color:var(--warm-brown);
      font-weight:700;
    }
    ul.items{list-style:none; padding:0; margin:0; display:grid; gap:6px;}

    .item-row{
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:12px;
      background:white;
      border:1px solid rgba(99,63,33,.1);
    }
    .item-row small{color:var(--muted)}
    .claimed{
      font-size:.8rem; font-weight:700;
      color:white; background:var(--cranberry);
      padding:4px 8px; border-radius:999px; white-space:nowrap;
    }
    .unclaimed{
      font-size:.8rem; font-weight:700;
      color:var(--warm-brown); background:#fff3d6;
      padding:4px 8px; border-radius:999px; white-space:nowrap;
      border:1px solid rgba(245,96,4,.25);
    }

    /* Form */
    label{display:block; font-weight:800; margin:8px 0 5px; color:var(--deep-brown);}
    input, select, textarea, button{
      width:100%;
      padding:10px 11px;
      font-size:1rem;
      border-radius:12px;
      border:1px solid rgba(34,19,13,.15);
      background:#fff;
      color:var(--text);
      outline:none;
      font-family:inherit;
    }
    textarea{min-height:70px; resize:vertical}

    .row{display:grid; gap:8px; grid-template-columns:1fr 1fr;}
    @media (max-width:520px){ .row{grid-template-columns:1fr;} }

    .btn{
      cursor:pointer; border:none;
      background:linear-gradient(135deg,var(--pumpkin), #ff8b3d);
      color:white; font-weight:900;
      margin-top:8px;
      box-shadow:0 8px 18px rgba(245,96,4,.25);
      letter-spacing:.3px;
    }
    .btn.secondary{
      background:#fff8ef; color:var(--warm-brown);
      border:1px solid rgba(245,96,4,.25);
      box-shadow:none;
      font-weight:800;
    }

    .notice{
      margin-top:8px;
      padding:8px 10px;
      border-radius:12px;
      font-size:.95rem;
      background:var(--cream);
      border:1px solid rgba(99,63,33,.18);
    }
    .notice.good{background:#eefbea; border-color:#bfe8c9; color:#186b2c; font-weight:800;}
    .notice.warn{background:#fff0f0; border-color:#f0bcbc; color:#8b1a1a; font-weight:800;}
    .muted{color:var(--muted); font-weight:600;}

    .loading{color:var(--muted); font-size:1rem;}
    footer{
      text-align:center;
      font-size:.95rem;
      color:var(--muted);
      padding:0 14px 22px;
    }
  </style>
</head>
<body>

  <section class="hero">
    <div class="hero-inner">
      <h1>üß° Thanksgiving Potluck</h1>
      <p>Let‚Äôs build a table full of love. Pick something to bring ‚Äî or add your own idea.</p>
    </div>
  </section>

  <main class="wrap">

    <!-- LEFT: LIVE LIST -->
    <section class="card">
      <h2>What We‚Äôve Got So Far</h2>
      <div id="listArea" class="loading">Loading the list...</div>
    </section>

    <!-- RIGHT: SIMPLE FORM -->
    <section class="card">
      <h2>Claim Your Dish</h2>

      <form id="signupForm">
        <label>Your name</label>
        <input id="name" required placeholder="Type your name"/>

        <div class="row">
          <div>
            <label>Category</label>
            <select id="categorySelect"></select>
          </div>
          <div>
            <label>Item</label>
            <select id="itemSelect"></select>
          </div>
        </div>

        <label>Serving / quantity (optional)</label>
        <input id="quantity" placeholder="e.g., feeds 6 / 2 trays / 1 pie"/>

        <label>Notes (optional)</label>
        <textarea id="notes" placeholder="Dietary notes, flavor, brand, etc."></textarea>

        <button class="btn" type="submit">I‚Äôll bring this üçÅ</button>
        <div id="status"></div>

        <hr style="margin:14px 0; border:none; height:1px; background:rgba(99,63,33,.15)"/>

        <h2 style="font-size:1.15rem;margin-top:0;">Add Something New</h2>
        <p class="muted" style="margin:0 0 6px;">Not on the list? Add it here.</p>

        <label>Put it under‚Ä¶</label>
        <div class="row">
          <select id="addCategoryExisting"></select>
          <input id="addCategoryNew" placeholder="or type a new category"/>
        </div>

        <label>New item</label>
        <input id="addItemName" placeholder="e.g., sweet potato casserole"/>

        <label>Notes (optional)</label>
        <input id="addItemNotes" placeholder="e.g., vegan / extra marshmallows"/>

        <button class="btn secondary" type="button" id="addItemBtn">Add to list ü•ß</button>
        <div id="addItemStatus"></div>
      </form>
    </section>

  </main>

  <footer>
    ‚ÄúGratitude turns what we have into enough.‚Äù üçÇ
  </footer>

<script>
  // Paste your deployed Apps Script Web App URL here:
  const SCRIPT_URL = "PASTE_YOUR_WEB_APP_URL_HERE";

  const listArea = document.getElementById('listArea');
  const categorySelect = document.getElementById('categorySelect');
  const itemSelect = document.getElementById('itemSelect');
  const addCategoryExisting = document.getElementById('addCategoryExisting');

  let dataCache = { categories: {}, signups: [] };

  function setStatus(el, msg, kind="muted"){
    el.innerHTML = `<div class="notice ${kind}">${msg}</div>`;
  }
  function clearStatus(el){ el.innerHTML = ""; }

  async function fetchData(){
    const res = await fetch(`${SCRIPT_URL}?action=list`, { method:"GET" });
    const json = await res.json();
    dataCache = json;

    renderList(json);
    populateCategorySelectors(json);
  }

  function renderList(json){
    const { categories, signups } = json;

    if (!categories || Object.keys(categories).length === 0){
      listArea.innerHTML = `<div class="notice warn">No items yet ‚Äî be the first to add one!</div>`;
      return;
    }

    const claimed = {};
    (signups || []).forEach(s => {
      const key = `${s.category}||${s.item}`;
      claimed[key] = claimed[key] || [];
      claimed[key].push(s.name + (s.quantity ? ` (${s.quantity})` : ""));
    });

    let html = "";
    Object.keys(categories).sort().forEach(cat => {
      const items = categories[cat] || [];
      const total = items.length;

      html += `
        <div class="category">
          <h3>${cat} <span class="pill">${total}</span></h3>
          <ul class="items">
      `;

      items.forEach(it => {
        const key = `${cat}||${it.name}`;
        const who = claimed[key] || [];
        const badge = who.length
          ? `<span class="claimed">${who.join(", ")}</span>`
          : `<span class="unclaimed">Still open</span>`;

        html += `
          <li class="item-row">
            <div>
              <strong>${it.name}</strong>
              ${it.notes ? `<br><small>${it.notes}</small>` : ``}
            </div>
            ${badge}
          </li>`;
      });

      html += `</ul></div>`;
    });

    listArea.innerHTML = html;
  }

  function populateCategorySelectors(json){
    const cats = Object.keys(json.categories || {}).sort();

    categorySelect.innerHTML = cats.map(c=>`<option value="${c}">${c}</option>`).join("");
    addCategoryExisting.innerHTML =
      `<option value="">Choose existing</option>` +
      cats.map(c=>`<option value="${c}">${c}</option>`).join("");

    updateItemSelect();
  }

  function updateItemSelect(){
    const cat = categorySelect.value;
    const items = (dataCache.categories && dataCache.categories[cat]) || [];
    itemSelect.innerHTML = items.map(i=>`<option value="${i.name}">${i.name}</option>`).join("");
    if (items.length === 0){
      itemSelect.innerHTML = `<option value="">(No items yet)</option>`;
    }
  }
  categorySelect.addEventListener("change", updateItemSelect);

  document.getElementById("signupForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const status = document.getElementById("status");
    clearStatus(status);

    const name = document.getElementById("name").value.trim();
    const category = categorySelect.value;
    const item = itemSelect.value;
    const quantity = document.getElementById("quantity").value.trim();
    const notes = document.getElementById("notes").value.trim();

    if(!name || !category || !item){
      setStatus(status, "Please enter your name and pick an item.", "warn");
      return;
    }

    const body = new URLSearchParams({
      action:"signup", name, category, item, quantity, notes
    });

    try{
      setStatus(status, "Saving your signup‚Ä¶", "muted");
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers: { "Content-Type":"application/x-www-form-urlencoded;charset=UTF-8" },
        body
      });
      const json = await res.json();
      if(json.ok){
        setStatus(status, "Locked in! Can‚Äôt wait to taste it üòÑ", "good");
        await fetchData();
      }else{
        setStatus(status, json.error || "Something went wrong.", "warn");
      }
    }catch(err){
      setStatus(status, "Could not reach server. Check SCRIPT_URL.", "warn");
    }
  });

  document.getElementById("addItemBtn").addEventListener("click", async ()=>{
    const addItemStatus = document.getElementById("addItemStatus");
    clearStatus(addItemStatus);

    const existing = addCategoryExisting.value.trim();
    const newCat = document.getElementById("addCategoryNew").value.trim();
    const itemName = document.getElementById("addItemName").value.trim();
    const itemNotes = document.getElementById("addItemNotes").value.trim();

    const category = newCat || existing;
    if(!category){
      setStatus(addItemStatus, "Pick a category or type a new one.", "warn");
      return;
    }
    if(!itemName){
      setStatus(addItemStatus, "Type the new item name.", "warn");
      return;
    }

    const body = new URLSearchParams({
      action:"addItem", category, item: itemName, notes: itemNotes
    });

    try{
      setStatus(addItemStatus, "Adding your idea‚Ä¶", "muted");
      const res = await fetch(SCRIPT_URL, {
        method:"POST",
        headers: { "Content-Type":"application/x-www-form-urlencoded;charset=UTF-8" },
        body
      });
      const json = await res.json();
      if(json.ok){
        setStatus(addItemStatus, `Added! "${itemName}" is now on the list.`, "good");

        document.getElementById("addCategoryNew").value="";
        document.getElementById("addItemName").value="";
        document.getElementById("addItemNotes").value="";
        addCategoryExisting.value="";

        await fetchData();
        categorySelect.value = category;
        updateItemSelect();
        itemSelect.value = itemName;
      }else{
        setStatus(addItemStatus, json.error || "Could not add item.", "warn");
      }
    }catch(err){
      setStatus(addItemStatus, "Could not reach server. Check SCRIPT_URL.", "warn");
    }
  });

  fetchData();
</script>
</body>
</html>
